{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "steamship.agents.schema.chathistory", "body": "<h1>Source code for steamship.agents.schema.chathistory</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">__future__</span> <span class=\"kn\">import</span> <span class=\"n\">annotations</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">uuid</span>\n<span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Dict</span><span class=\"p\">,</span> <span class=\"n\">List</span><span class=\"p\">,</span> <span class=\"n\">Optional</span><span class=\"p\">,</span> <span class=\"n\">Union</span><span class=\"p\">,</span> <span class=\"n\">cast</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">steamship</span> <span class=\"kn\">import</span> <span class=\"n\">File</span><span class=\"p\">,</span> <span class=\"n\">MimeTypes</span><span class=\"p\">,</span> <span class=\"n\">Steamship</span><span class=\"p\">,</span> <span class=\"n\">SteamshipError</span><span class=\"p\">,</span> <span class=\"n\">Task</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.agents.schema.message_selectors</span> <span class=\"kn\">import</span> <span class=\"n\">MessageSelector</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.agents.schema.text_splitters</span> <span class=\"kn\">import</span> <span class=\"n\">FixedSizeTextSplitter</span><span class=\"p\">,</span> <span class=\"n\">TextSplitter</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.base.client</span> <span class=\"kn\">import</span> <span class=\"n\">Client</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.data</span> <span class=\"kn\">import</span> <span class=\"n\">TagKind</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.data.block</span> <span class=\"kn\">import</span> <span class=\"n\">Block</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.data.plugin.index_plugin_instance</span> <span class=\"kn\">import</span> <span class=\"n\">EmbeddingIndexPluginInstance</span><span class=\"p\">,</span> <span class=\"n\">SearchResults</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.data.tags</span> <span class=\"kn\">import</span> <span class=\"n\">Tag</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.data.tags.tag_constants</span> <span class=\"kn\">import</span> <span class=\"n\">ChatTag</span><span class=\"p\">,</span> <span class=\"n\">DocTag</span><span class=\"p\">,</span> <span class=\"n\">RoleTag</span><span class=\"p\">,</span> <span class=\"n\">TagValueKey</span>\n\n\n<div class=\"viewcode-block\" id=\"ChatHistory\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">ChatHistory</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;A ChatHistory is a wrapper of a File ideal for ongoing interactions between a user and a virtual assistant.</span>\n<span class=\"sd\">    It also includes vector-backed storage for similarity-based retrieval.&quot;&quot;&quot;</span>\n\n    <span class=\"n\">file</span><span class=\"p\">:</span> <span class=\"n\">File</span>\n    <span class=\"n\">embedding_index</span><span class=\"p\">:</span> <span class=\"n\">EmbeddingIndexPluginInstance</span>\n    <span class=\"n\">text_splitter</span><span class=\"p\">:</span> <span class=\"n\">TextSplitter</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">file</span><span class=\"p\">:</span> <span class=\"n\">File</span><span class=\"p\">,</span>\n        <span class=\"n\">embedding_index</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">EmbeddingIndexPluginInstance</span><span class=\"p\">],</span>\n        <span class=\"n\">text_splitter</span><span class=\"p\">:</span> <span class=\"n\">TextSplitter</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;This init method is intended only for private use within the class. See `Chat.create()`&quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"n\">file</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span> <span class=\"o\">=</span> <span class=\"n\">embedding_index</span>\n        <span class=\"k\">if</span> <span class=\"n\">text_splitter</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">FixedSizeTextSplitter</span><span class=\"p\">(</span><span class=\"n\">chunk_size</span><span class=\"o\">=</span><span class=\"mi\">300</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_get_existing_file</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">:</span> <span class=\"n\">Client</span><span class=\"p\">,</span> <span class=\"n\">context_keys</span><span class=\"p\">:</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">])</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">File</span><span class=\"p\">]:</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Find an existing File object whose memory Tag matches the passed memory keys&quot;&quot;&quot;</span>\n        <span class=\"n\">file_query</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"sa\">f</span><span class=\"s1\">&#39;kind &quot;</span><span class=\"si\">{</span><span class=\"n\">TagKind</span><span class=\"o\">.</span><span class=\"n\">CHAT</span><span class=\"si\">}</span><span class=\"s1\">&quot; and name &quot;</span><span class=\"si\">{</span><span class=\"n\">ChatTag</span><span class=\"o\">.</span><span class=\"n\">CONTEXT_KEYS</span><span class=\"si\">}</span><span class=\"s1\">&quot;&#39;</span>\n            <span class=\"o\">+</span> <span class=\"p\">(</span><span class=\"s2\">&quot; and &quot;</span> <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">context_keys</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">)</span>\n            <span class=\"o\">+</span> <span class=\"s2\">&quot; and &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">([</span><span class=\"sa\">f</span><span class=\"s1\">&#39;value(&quot;</span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&quot;) = &quot;</span><span class=\"si\">{</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;&#39;</span> <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">context_keys</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()])</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"n\">File</span><span class=\"o\">.</span><span class=\"n\">query</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">,</span> <span class=\"n\">file_query</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">files</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">files</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">files</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">SteamshipError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Multiple ChatHistory objects have been created in this workspace with these memory keys.&quot;</span>\n            <span class=\"p\">)</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_get_index_handle_from_file</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">:</span> <span class=\"n\">File</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n        <span class=\"k\">for</span> <span class=\"n\">tag</span> <span class=\"ow\">in</span> <span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">tags</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">kind</span> <span class=\"o\">==</span> <span class=\"n\">TagKind</span><span class=\"o\">.</span><span class=\"n\">CHAT</span> <span class=\"ow\">and</span> <span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"n\">ChatTag</span><span class=\"o\">.</span><span class=\"n\">INDEX_HANDLE</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">[</span><span class=\"n\">TagValueKey</span><span class=\"o\">.</span><span class=\"n\">STRING_VALUE</span><span class=\"p\">]</span>\n        <span class=\"k\">raise</span> <span class=\"n\">SteamshipError</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Could not find index handle on file with id </span><span class=\"si\">{</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">id</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_get_embedding_index</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">:</span> <span class=\"n\">Steamship</span><span class=\"p\">,</span> <span class=\"n\">index_handle</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">EmbeddingIndexPluginInstance</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">cast</span><span class=\"p\">(</span>\n            <span class=\"n\">EmbeddingIndexPluginInstance</span><span class=\"p\">,</span>\n            <span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">use_plugin</span><span class=\"p\">(</span>\n                <span class=\"n\">plugin_handle</span><span class=\"o\">=</span><span class=\"s2\">&quot;embedding-index&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">instance_handle</span><span class=\"o\">=</span><span class=\"n\">index_handle</span><span class=\"p\">,</span>\n                <span class=\"n\">config</span><span class=\"o\">=</span><span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;embedder&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;plugin_handle&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;openai-embedder&quot;</span><span class=\"p\">,</span>\n                        <span class=\"s2\">&quot;plugin_instance-handle&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;text-embedding-ada-002&quot;</span><span class=\"p\">,</span>\n                        <span class=\"s2\">&quot;fetch_if_exists&quot;</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>\n                        <span class=\"s2\">&quot;config&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;model&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;text-embedding-ada-002&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;dimensionality&quot;</span><span class=\"p\">:</span> <span class=\"mi\">1536</span><span class=\"p\">},</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">},</span>\n                <span class=\"n\">fetch_if_exists</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.get_or_create\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.get_or_create\">[docs]</a>    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">get_or_create</span><span class=\"p\">(</span>\n        <span class=\"n\">client</span><span class=\"p\">:</span> <span class=\"n\">Steamship</span><span class=\"p\">,</span>\n        <span class=\"n\">context_keys</span><span class=\"p\">:</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">],</span>\n        <span class=\"n\">tags</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Tag</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">searchable</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">ChatHistory</span><span class=\"p\">:</span>\n\n        <span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"n\">ChatHistory</span><span class=\"o\">.</span><span class=\"n\">_get_existing_file</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">,</span> <span class=\"n\">context_keys</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">file</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">tags</span> <span class=\"o\">=</span> <span class=\"n\">tags</span> <span class=\"ow\">or</span> <span class=\"p\">[]</span>\n            <span class=\"n\">index_handle</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">uuid</span><span class=\"o\">.</span><span class=\"n\">uuid4</span><span class=\"p\">())</span>\n            <span class=\"n\">tags</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">Tag</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"n\">TagKind</span><span class=\"o\">.</span><span class=\"n\">DOCUMENT</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">DocTag</span><span class=\"o\">.</span><span class=\"n\">CHAT</span><span class=\"p\">))</span>\n            <span class=\"n\">tags</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">Tag</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"n\">TagKind</span><span class=\"o\">.</span><span class=\"n\">CHAT</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">ChatTag</span><span class=\"o\">.</span><span class=\"n\">CONTEXT_KEYS</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">context_keys</span><span class=\"p\">))</span>\n            <span class=\"n\">tags</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                <span class=\"n\">Tag</span><span class=\"p\">(</span>\n                    <span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"n\">TagKind</span><span class=\"o\">.</span><span class=\"n\">CHAT</span><span class=\"p\">,</span>\n                    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">ChatTag</span><span class=\"o\">.</span><span class=\"n\">INDEX_HANDLE</span><span class=\"p\">,</span>\n                    <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"n\">TagValueKey</span><span class=\"o\">.</span><span class=\"n\">STRING_VALUE</span><span class=\"p\">:</span> <span class=\"n\">index_handle</span><span class=\"p\">},</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"n\">blocks</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n            <span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"n\">File</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span>\n                <span class=\"n\">client</span><span class=\"o\">=</span><span class=\"n\">client</span><span class=\"p\">,</span>\n                <span class=\"n\">blocks</span><span class=\"o\">=</span><span class=\"n\">blocks</span><span class=\"p\">,</span>\n                <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">index_handle</span> <span class=\"o\">=</span> <span class=\"n\">ChatHistory</span><span class=\"o\">.</span><span class=\"n\">_get_index_handle_from_file</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">searchable</span><span class=\"p\">:</span>\n            <span class=\"n\">embedding_index</span> <span class=\"o\">=</span> <span class=\"n\">ChatHistory</span><span class=\"o\">.</span><span class=\"n\">_get_embedding_index</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">,</span> <span class=\"n\">index_handle</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">embedding_index</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">ChatHistory</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"n\">embedding_index</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.append_message_with_role\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.append_message_with_role\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">append_message_with_role</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">text</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">role</span><span class=\"p\">:</span> <span class=\"n\">RoleTag</span> <span class=\"o\">=</span> <span class=\"n\">RoleTag</span><span class=\"o\">.</span><span class=\"n\">USER</span><span class=\"p\">,</span>\n        <span class=\"n\">tags</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Tag</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">content</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"nb\">bytes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">url</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">mime_type</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">MimeTypes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Block</span><span class=\"p\">:</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Append a new block to this with content provided by the end-user.&quot;&quot;&quot;</span>\n        <span class=\"n\">tags</span> <span class=\"o\">=</span> <span class=\"n\">tags</span> <span class=\"ow\">or</span> <span class=\"p\">[]</span>\n        <span class=\"n\">tags</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">Tag</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"n\">TagKind</span><span class=\"o\">.</span><span class=\"n\">CHAT</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">ChatTag</span><span class=\"o\">.</span><span class=\"n\">ROLE</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"n\">TagValueKey</span><span class=\"o\">.</span><span class=\"n\">STRING_VALUE</span><span class=\"p\">:</span> <span class=\"n\">role</span><span class=\"p\">})</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">block</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">append_block</span><span class=\"p\">(</span>\n            <span class=\"n\">text</span><span class=\"o\">=</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"o\">=</span><span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">url</span><span class=\"o\">=</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">mime_type</span><span class=\"o\">=</span><span class=\"n\">mime_type</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">chunk_tags</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text_splitter</span><span class=\"o\">.</span><span class=\"n\">chunk_text_to_tags</span><span class=\"p\">(</span>\n                <span class=\"n\">block</span><span class=\"p\">,</span> <span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"n\">TagKind</span><span class=\"o\">.</span><span class=\"n\">CHAT</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">ChatTag</span><span class=\"o\">.</span><span class=\"n\">CHUNK</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">block</span><span class=\"o\">.</span><span class=\"n\">tags</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"n\">chunk_tags</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"n\">chunk_tags</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">block</span></div>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.append_user_message\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.append_user_message\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">append_user_message</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">text</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">tags</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Tag</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">content</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"nb\">bytes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">url</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">mime_type</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">MimeTypes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Block</span><span class=\"p\">:</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Append a new block to this with content provided by the end-user.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">append_message_with_role</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">RoleTag</span><span class=\"o\">.</span><span class=\"n\">USER</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">mime_type</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.append_system_message\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.append_system_message\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">append_system_message</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">text</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">tags</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Tag</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">content</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"nb\">bytes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">url</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">mime_type</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">MimeTypes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Block</span><span class=\"p\">:</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Append a new block to this with content provided by the system, i.e., instructions to the assistant.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">append_message_with_role</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">RoleTag</span><span class=\"o\">.</span><span class=\"n\">SYSTEM</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">mime_type</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.append_assistant_message\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.append_assistant_message\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">append_assistant_message</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">text</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">tags</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Tag</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">content</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"nb\">bytes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">url</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">mime_type</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">MimeTypes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Block</span><span class=\"p\">:</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Append a new block to this with content provided by the agent, i.e., results from the assistant.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">append_message_with_role</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">RoleTag</span><span class=\"o\">.</span><span class=\"n\">ASSISTANT</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">mime_type</span><span class=\"p\">)</span></div>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">last_user_message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">Block</span><span class=\"p\">]:</span>\n        <span class=\"k\">for</span> <span class=\"n\">block</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">blocks</span><span class=\"p\">[::</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]:</span>\n            <span class=\"k\">if</span> <span class=\"n\">block</span><span class=\"o\">.</span><span class=\"n\">chat_role</span> <span class=\"o\">==</span> <span class=\"n\">RoleTag</span><span class=\"o\">.</span><span class=\"n\">USER</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">block</span>\n        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">last_system_message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">Block</span><span class=\"p\">]:</span>\n        <span class=\"k\">for</span> <span class=\"n\">block</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">blocks</span><span class=\"p\">[::</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]:</span>\n            <span class=\"k\">if</span> <span class=\"n\">block</span><span class=\"o\">.</span><span class=\"n\">chat_role</span> <span class=\"o\">==</span> <span class=\"n\">RoleTag</span><span class=\"o\">.</span><span class=\"n\">SYSTEM</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">block</span>\n        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">last_agent_message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">Block</span><span class=\"p\">]:</span>\n        <span class=\"k\">for</span> <span class=\"n\">block</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">blocks</span><span class=\"p\">[::</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]:</span>\n            <span class=\"k\">if</span> <span class=\"n\">block</span><span class=\"o\">.</span><span class=\"n\">chat_role</span> <span class=\"o\">==</span> <span class=\"n\">RoleTag</span><span class=\"o\">.</span><span class=\"n\">ASSISTANT</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">block</span>\n        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">initial_system_prompt</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">Block</span><span class=\"p\">]:</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">blocks</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">blocks</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">chat_role</span> <span class=\"o\">==</span> <span class=\"n\">RoleTag</span><span class=\"o\">.</span><span class=\"n\">SYSTEM</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">blocks</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.refresh\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.refresh\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">refresh</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">()</span></div>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">tags</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Tag</span><span class=\"p\">]:</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">tags</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">messages</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Block</span><span class=\"p\">]:</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">blocks</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">client</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Client</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">client</span>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.select_messages\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.select_messages\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">select_messages</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">selector</span><span class=\"p\">:</span> <span class=\"n\">MessageSelector</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Block</span><span class=\"p\">]:</span>\n        <span class=\"k\">return</span> <span class=\"n\">selector</span><span class=\"o\">.</span><span class=\"n\">get_messages</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">messages</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.search\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.search\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">search</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">text</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">k</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Task</span><span class=\"p\">[</span><span class=\"n\">SearchResults</span><span class=\"p\">]:</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">SteamshipError</span><span class=\"p\">(</span><span class=\"s2\">&quot;This ChatHistory has no embedding index and is not searchable.&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span><span class=\"o\">.</span><span class=\"n\">search</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">k</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.is_searchable\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.is_searchable\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">is_searchable</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">bool</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span></div>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.delete_messages\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.delete_messages\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">delete_messages</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">selector</span><span class=\"p\">:</span> <span class=\"n\">MessageSelector</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Delete a set of selected messages from the ChatHistory.</span>\n\n<span class=\"sd\">        If `selector == None`, no messages will be deleted.</span>\n\n<span class=\"sd\">        NOTES:</span>\n<span class=\"sd\">        - upon deletion, refresh() is called to ensure up-to-date history refs.</span>\n<span class=\"sd\">        - causes a full re-index of chat history if the history is searchable.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"n\">selector</span><span class=\"p\">:</span>\n            <span class=\"n\">selected_messages</span> <span class=\"o\">=</span> <span class=\"n\">selector</span><span class=\"o\">.</span><span class=\"n\">get_messages</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">messages</span><span class=\"p\">)</span>\n            <span class=\"k\">for</span> <span class=\"n\">msg</span> <span class=\"ow\">in</span> <span class=\"n\">selected_messages</span><span class=\"p\">:</span>\n                <span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">is_searchable</span><span class=\"p\">():</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span><span class=\"o\">.</span><span class=\"n\">reset</span><span class=\"p\">()</span>\n                <span class=\"k\">for</span> <span class=\"n\">msg</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">messages</span><span class=\"p\">:</span>\n                    <span class=\"k\">for</span> <span class=\"n\">tag</span> <span class=\"ow\">in</span> <span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">tags</span><span class=\"p\">:</span>\n                        <span class=\"k\">if</span> <span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">kind</span> <span class=\"o\">==</span> <span class=\"n\">TagKind</span><span class=\"o\">.</span><span class=\"n\">CHAT</span> <span class=\"ow\">and</span> <span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"n\">ChatTag</span><span class=\"o\">.</span><span class=\"n\">CHUNK</span><span class=\"p\">:</span>\n                            <span class=\"c1\"># TODO(dougreid): figure out why tag.text gets lost.</span>\n                            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"p\">:</span>\n                                <span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"p\">[</span><span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">start_idx</span> <span class=\"p\">:</span> <span class=\"n\">tag</span><span class=\"o\">.</span><span class=\"n\">end_idx</span><span class=\"p\">]</span>\n                            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"ChatHistory.clear\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.schema/#steamship.agents.schema.chathistory.ChatHistory.clear\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">clear</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Deletes ALL messages from the ChatHistory (including system).</span>\n\n<span class=\"sd\">        NOTE: upon deletion, refresh() is called to ensure up-to-date history refs.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">for</span> <span class=\"n\">block</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">blocks</span><span class=\"p\">:</span>\n            <span class=\"n\">block</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span>\n\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">is_searchable</span><span class=\"p\">():</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_index</span><span class=\"o\">.</span><span class=\"n\">reset</span><span class=\"p\">()</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">()</span></div></div>\n</pre></div>", "current_page_name": "_modules/steamship/agents/schema/chathistory", "sidebars": ["sidebar/brand.html", "sidebar/search.html", "sidebar/scroll-start.html", "sidebar/navigation.html", "sidebar/ethical-ads.html", "sidebar/scroll-end.html", "sidebar/variant-selector.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.12", "furo_version": "2023.03.27", "furo_navigation_tree": "", "furo_hide_toc": true, "furo_pygments": {"light": {"background": "#f8f8f8", "foreground": "black"}, "dark": {"background": "#272822", "foreground": "#f8f8f2"}}}