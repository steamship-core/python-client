{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "steamship.agents.react.react", "body": "<h1>Source code for steamship.agents.react.react</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">List</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.agents.react.output_parser</span> <span class=\"kn\">import</span> <span class=\"n\">ReACTOutputParser</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.agents.schema</span> <span class=\"kn\">import</span> <span class=\"n\">LLM</span><span class=\"p\">,</span> <span class=\"n\">Action</span><span class=\"p\">,</span> <span class=\"n\">AgentContext</span><span class=\"p\">,</span> <span class=\"n\">LLMAgent</span><span class=\"p\">,</span> <span class=\"n\">Tool</span>\n\n\n<div class=\"viewcode-block\" id=\"ReACTAgent\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.react/#steamship.agents.react.react.ReACTAgent\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">ReACTAgent</span><span class=\"p\">(</span><span class=\"n\">LLMAgent</span><span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Selects actions for AgentService based on a ReACT style LLM Prompt and a configured set of Tools.</span>\n\n<span class=\"sd\">    NOTE: Deprecated. Use at your own risk.</span>\n\n<span class=\"sd\">    WARNING: This model should only be used with LLMs that use the older model versions of gpt-4 (gpt-4-0314)</span>\n<span class=\"sd\">    and gpt-3.5-turbo (gpt-3.5-turbo-0301). Those models will be discontinued on 9-13-2023. Use of this agent</span>\n<span class=\"sd\">    after that date will likely lead to complete reasoning failures.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"n\">PROMPT</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&quot;&quot;Assistant is a large language model trained by OpenAI.</span>\n<span class=\"s2\">Assistant is designed to be able to assist with a wide range of tasks, from answering simple questions to providing in-depth explanations and discussions on a wide range of topics. As a language model, Assistant is able to generate human-like text based on the input it receives, allowing it to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand.</span>\n<span class=\"s2\">Assistant is constantly learning and improving, and its capabilities are constantly evolving. It is able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. Additionally, Assistant is able to generate its own text based on the input it receives, allowing it to engage in discussions and provide explanations and descriptions on a wide range of topics.</span>\n<span class=\"s2\">Overall, Assistant is a powerful tool that can help with a wide range of tasks and provide valuable insights and information on a wide range of topics. Whether you need help with a specific question or just want to have a conversation about a particular topic, Assistant is here to assist.</span>\n\n<span class=\"s2\">TOOLS:</span>\n<span class=\"s2\">------</span>\n<span class=\"s2\">Assistant has access to the following tools:</span>\n<span class=\"si\">{tool_index}</span>\n<span class=\"s2\">To use a tool, you MUST use the following format:</span>\n<span class=\"s2\">```</span>\n<span class=\"s2\">Thought: Do I need to use a tool? Yes</span>\n<span class=\"s2\">Action: the action to take, should be one of </span><span class=\"si\">{tool_names}</span>\n<span class=\"s2\">Action Input: the input to the action</span>\n<span class=\"s2\">Observation: the result of the action</span>\n<span class=\"s2\">```</span>\n\n\n<span class=\"s2\">If you decide that you should use a Tool, you must generate the associated Action and Action Input.</span>\n\n<span class=\"s2\">Some tools will return Observations in the format of `Block(&lt;identifier&gt;)`. This will represent a successful completion</span>\n<span class=\"s2\">of that step and can be passed to subsequent tools, or returned to a user to answer their questions.</span>\n\n<span class=\"s2\">When you have a final response to say to the Human, or if you do not need to use a tool, you MUST use the format:</span>\n\n<span class=\"s2\">```</span>\n<span class=\"s2\">Thought: Do I need to use a tool? No</span>\n<span class=\"s2\">AI: [your final response here]</span>\n<span class=\"s2\">```</span>\n\n<span class=\"s2\">If a Tool generated an Observation that includes `Block(&lt;identifier&gt;)` and you wish to return it to the user, ALWAYS</span>\n<span class=\"s2\">end your response with the `Block(&lt;identifier&gt;)` observation. To do so, you MUST use the format:</span>\n\n<span class=\"s2\">```</span>\n<span class=\"s2\">Thought: Do I need to use a tool? No</span>\n<span class=\"s2\">AI: [your response with a suffix of: &quot;Block(&lt;identifier&gt;)&quot;].</span>\n<span class=\"s2\">```</span>\n\n<span class=\"s2\">Make sure to use all observations to come up with your final response.</span>\n<span class=\"s2\">You MUST include `Block(&lt;identifier&gt;)` segments in responses that generate images or audio.</span>\n<span class=\"s2\">DO NOT include `Block(&lt;identifier&gt;)` segments in responses that do not have generated images or audio.</span>\n\n<span class=\"s2\">Begin!</span>\n\n<span class=\"s2\">Previous conversation history:</span>\n<span class=\"si\">{chat_history}</span>\n\n<span class=\"s2\">Other relevant previous conversation:</span>\n<span class=\"si\">{relevant_history}</span>\n\n<span class=\"s2\">New input: </span><span class=\"si\">{input}</span>\n<span class=\"si\">{scratchpad}</span><span class=\"s2\">&quot;&quot;&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">tools</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Tool</span><span class=\"p\">],</span> <span class=\"n\">llm</span><span class=\"p\">:</span> <span class=\"n\">LLM</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span>\n            <span class=\"n\">output_parser</span><span class=\"o\">=</span><span class=\"n\">ReACTOutputParser</span><span class=\"p\">(</span><span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"n\">tools</span><span class=\"p\">),</span> <span class=\"n\">llm</span><span class=\"o\">=</span><span class=\"n\">llm</span><span class=\"p\">,</span> <span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"n\">tools</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span>\n        <span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ReACTAgent.next_action\"><a class=\"viewcode-back\" href=\"../../../../../api/steamship.agents.react/#steamship.agents.react.react.ReACTAgent.next_action\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">next_action</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">:</span> <span class=\"n\">AgentContext</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Action</span><span class=\"p\">:</span>\n        <span class=\"n\">scratchpad</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_construct_scratchpad</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">)</span>\n        <span class=\"n\">tool_names</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"k\">for</span> <span class=\"n\">t</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">tools</span><span class=\"p\">]</span>\n\n        <span class=\"n\">tool_index_parts</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"sa\">f</span><span class=\"s2\">&quot;- </span><span class=\"si\">{</span><span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s2\">: </span><span class=\"si\">{</span><span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">agent_description</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span> <span class=\"k\">for</span> <span class=\"n\">t</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">tools</span><span class=\"p\">]</span>\n        <span class=\"n\">tool_index</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">tool_index_parts</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># for simplicity assume initial prompt is a single text block.</span>\n        <span class=\"c1\"># in reality, use some sort of formatter ?</span>\n        <span class=\"n\">prompt</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">PROMPT</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n            <span class=\"nb\">input</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">chat_history</span><span class=\"o\">.</span><span class=\"n\">last_user_message</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"p\">,</span>\n            <span class=\"n\">tool_index</span><span class=\"o\">=</span><span class=\"n\">tool_index</span><span class=\"p\">,</span>\n            <span class=\"n\">tool_names</span><span class=\"o\">=</span><span class=\"n\">tool_names</span><span class=\"p\">,</span>\n            <span class=\"n\">scratchpad</span><span class=\"o\">=</span><span class=\"n\">scratchpad</span><span class=\"p\">,</span>\n            <span class=\"n\">chat_history</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">messages_to_prompt_history</span><span class=\"p\">(</span>\n                <span class=\"n\">messages</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">chat_history</span><span class=\"o\">.</span><span class=\"n\">select_messages</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_selector</span><span class=\"p\">)</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">relevant_history</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">messages_to_prompt_history</span><span class=\"p\">(</span>\n                <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">chat_history</span><span class=\"o\">.</span><span class=\"n\">search</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">chat_history</span><span class=\"o\">.</span><span class=\"n\">last_user_message</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">k</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n                <span class=\"o\">.</span><span class=\"n\">wait</span><span class=\"p\">()</span>\n                <span class=\"o\">.</span><span class=\"n\">to_ranked_blocks</span><span class=\"p\">()</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">completions</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">llm</span><span class=\"o\">.</span><span class=\"n\">complete</span><span class=\"p\">(</span><span class=\"n\">prompt</span><span class=\"o\">=</span><span class=\"n\">prompt</span><span class=\"p\">,</span> <span class=\"n\">stop</span><span class=\"o\">=</span><span class=\"s2\">&quot;Observation:&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">output_parser</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"n\">completions</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_construct_scratchpad</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">):</span>\n        <span class=\"n\">steps</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">action</span> <span class=\"ow\">in</span> <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">completed_steps</span><span class=\"p\">:</span>\n            <span class=\"n\">steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Thought: Do I need to use a tool? Yes</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n                <span class=\"sa\">f</span><span class=\"s2\">&quot;Action: </span><span class=\"si\">{</span><span class=\"n\">action</span><span class=\"o\">.</span><span class=\"n\">tool</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n                <span class=\"sa\">f</span><span class=\"s1\">&#39;Action Input: </span><span class=\"si\">{</span><span class=\"s2\">&quot; &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">([</span><span class=\"n\">b</span><span class=\"o\">.</span><span class=\"n\">as_llm_input</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"ow\">in</span><span class=\"w\"> </span><span class=\"n\">action</span><span class=\"o\">.</span><span class=\"n\">input</span><span class=\"p\">])</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n                <span class=\"sa\">f</span><span class=\"s1\">&#39;Observation: </span><span class=\"si\">{</span><span class=\"s2\">&quot; &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">([</span><span class=\"n\">b</span><span class=\"o\">.</span><span class=\"n\">as_llm_input</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"ow\">in</span><span class=\"w\"> </span><span class=\"n\">action</span><span class=\"o\">.</span><span class=\"n\">output</span><span class=\"p\">])</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n            <span class=\"p\">)</span>\n        <span class=\"n\">scratchpad</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">steps</span><span class=\"p\">)</span>\n        <span class=\"n\">scratchpad</span> <span class=\"o\">+=</span> <span class=\"s2\">&quot;Thought:&quot;</span>\n        <span class=\"k\">return</span> <span class=\"n\">scratchpad</span></div>\n</pre></div>", "current_page_name": "_modules/steamship/agents/react/react", "sidebars": ["sidebar/brand.html", "sidebar/search.html", "sidebar/scroll-start.html", "sidebar/navigation.html", "sidebar/ethical-ads.html", "sidebar/scroll-end.html", "sidebar/variant-selector.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.12", "furo_version": "2023.03.27", "furo_navigation_tree": "", "furo_hide_toc": true, "furo_pygments": {"light": {"background": "#f8f8f8", "foreground": "black"}, "dark": {"background": "#272822", "foreground": "#f8f8f2"}}}