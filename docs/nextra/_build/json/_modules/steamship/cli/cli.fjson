{"parents": [{"link": "../../../", "title": "Module code"}], "title": "steamship.cli.cli", "body": "<h1>Source code for steamship.cli.cli</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">json</span>\n<span class=\"kn\">import</span> <span class=\"nn\">logging</span>\n<span class=\"kn\">import</span> <span class=\"nn\">signal</span>\n<span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n<span class=\"kn\">import</span> <span class=\"nn\">time</span>\n<span class=\"kn\">from</span> <span class=\"nn\">os</span> <span class=\"kn\">import</span> <span class=\"n\">getenv</span><span class=\"p\">,</span> <span class=\"n\">path</span>\n<span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Optional</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">click</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">steamship</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship</span> <span class=\"kn\">import</span> <span class=\"n\">Steamship</span><span class=\"p\">,</span> <span class=\"n\">SteamshipError</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.base.configuration</span> <span class=\"kn\">import</span> <span class=\"n\">DEFAULT_WEB_BASE</span><span class=\"p\">,</span> <span class=\"n\">Configuration</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.cli.create_instance</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">config_str_to_dict</span><span class=\"p\">,</span>\n    <span class=\"n\">create_instance</span><span class=\"p\">,</span>\n    <span class=\"n\">load_manifest</span><span class=\"p\">,</span>\n    <span class=\"n\">set_unset_params</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.cli.deploy</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">PackageDeployer</span><span class=\"p\">,</span>\n    <span class=\"n\">PluginDeployer</span><span class=\"p\">,</span>\n    <span class=\"n\">bundle_deployable</span><span class=\"p\">,</span>\n    <span class=\"n\">update_config_template</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.cli.local_server.server</span> <span class=\"kn\">import</span> <span class=\"n\">SteamshipHTTPServer</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.cli.manifest_init_wizard</span> <span class=\"kn\">import</span> <span class=\"n\">manifest_init_wizard</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.cli.requirements_init_wizard</span> <span class=\"kn\">import</span> <span class=\"n\">requirements_init_wizard</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.cli.ship_spinner</span> <span class=\"kn\">import</span> <span class=\"n\">ship_spinner</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.cli.utils</span> <span class=\"kn\">import</span> <span class=\"n\">find_api_py</span><span class=\"p\">,</span> <span class=\"n\">get_api_module</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.data.manifest</span> <span class=\"kn\">import</span> <span class=\"n\">DeployableType</span><span class=\"p\">,</span> <span class=\"n\">Manifest</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.data.user</span> <span class=\"kn\">import</span> <span class=\"n\">User</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.invocable.dev_logging_handler</span> <span class=\"kn\">import</span> <span class=\"n\">DevelopmentLoggingHandler</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.invocable.lambda_handler</span> <span class=\"kn\">import</span> <span class=\"n\">get_class_from_module</span>\n<span class=\"kn\">from</span> <span class=\"nn\">steamship.utils.repl</span> <span class=\"kn\">import</span> <span class=\"n\">HttpREPL</span>\n\n\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">group</span><span class=\"p\">()</span>\n<span class=\"k\">def</span> <span class=\"nf\">cli</span><span class=\"p\">():</span>\n    <span class=\"k\">pass</span>\n\n\n<div class=\"viewcode-block\" id=\"initialize\"><a class=\"viewcode-back\" href=\"../../../../api/steamship.cli/#steamship.cli.cli.initialize\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">initialize</span><span class=\"p\">(</span><span class=\"n\">suppress_message</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"n\">setLevel</span><span class=\"p\">(</span><span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">FATAL</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">suppress_message</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Steamship Python CLI version </span><span class=\"si\">{</span><span class=\"n\">steamship</span><span class=\"o\">.</span><span class=\"n\">__version__</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">command</span><span class=\"p\">()</span>\n<span class=\"k\">def</span> <span class=\"nf\">login</span><span class=\"p\">():</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Log in to Steamship, creating ~/.steamship.json&quot;&quot;&quot;</span>\n    <span class=\"n\">initialize</span><span class=\"p\">()</span>\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"s2\">&quot;Logging into Steamship.&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;login&quot;</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">Configuration</span><span class=\"o\">.</span><span class=\"n\">default_config_file_has_api_key</span><span class=\"p\">():</span>\n            <span class=\"n\">overwrite</span> <span class=\"o\">=</span> <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span>\n                <span class=\"n\">text</span><span class=\"o\">=</span><span class=\"s2\">&quot;You already have an API key in your .steamship.json file.  Do you want to remove it and login?&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">overwrite</span><span class=\"p\">:</span>\n                <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n            <span class=\"n\">Configuration</span><span class=\"o\">.</span><span class=\"n\">remove_api_key_from_default_config</span><span class=\"p\">()</span>\n\n        <span class=\"c1\"># Carry on with login</span>\n        <span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"n\">Steamship</span><span class=\"p\">()</span>\n        <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">User</span><span class=\"o\">.</span><span class=\"n\">current</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;\ud83d\udea2\ud83d\udea2\ud83d\udea2 Hooray! You&#39;re logged in with user handle: </span><span class=\"si\">{</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">handle</span><span class=\"si\">}</span><span class=\"s2\"> \ud83d\udea2\ud83d\udea2\ud83d\udea2&quot;</span><span class=\"p\">,</span> <span class=\"n\">fg</span><span class=\"o\">=</span><span class=\"s2\">&quot;green&quot;</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">command</span><span class=\"p\">()</span>\n<span class=\"k\">def</span> <span class=\"nf\">ships</span><span class=\"p\">():</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Ship some ships&quot;&quot;&quot;</span>\n    <span class=\"n\">initialize</span><span class=\"p\">()</span>\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;Here are some ships:&quot;</span><span class=\"p\">,</span> <span class=\"n\">fg</span><span class=\"o\">=</span><span class=\"s2\">&quot;cyan&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">with</span> <span class=\"n\">ship_spinner</span><span class=\"p\">():</span>\n        <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_run_ngrok</span><span class=\"p\">(</span><span class=\"n\">local_port</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Create an NGROK URL directed at `local_port`.&quot;&quot;&quot;</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">pyngrok</span> <span class=\"kn\">import</span> <span class=\"n\">ngrok</span>\n    <span class=\"k\">except</span> <span class=\"ne\">BaseException</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;\u26a0\ufe0f Public API: Unable to start ngrok. Please either:&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;   - Install pyngrok via `pip install pyngrok`&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;   - Use the --no_ngrok flag&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;   NGROK is only necessary if you wish to debug Telegram or Slack locally.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">http_tunnel</span> <span class=\"o\">=</span> <span class=\"n\">ngrok</span><span class=\"o\">.</span><span class=\"n\">connect</span><span class=\"p\">(</span><span class=\"n\">local_port</span><span class=\"p\">,</span> <span class=\"n\">bind_tls</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"ne\">BaseException</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;\u26a0\ufe0f Public API: Unable to bind ngrok to port </span><span class=\"si\">{</span><span class=\"n\">local_port</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;   - Try running with a different port via the  --port flag.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"n\">ngrok_api_url</span> <span class=\"o\">=</span> <span class=\"n\">http_tunnel</span><span class=\"o\">.</span><span class=\"n\">public_url</span>\n    <span class=\"k\">return</span> <span class=\"n\">ngrok_api_url</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_run_local_server</span><span class=\"p\">(</span>\n    <span class=\"n\">local_port</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n    <span class=\"n\">instance_handle</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">config</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">workspace</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">base_url</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span>\n        <span class=\"nb\">str</span>\n    <span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>  <span class=\"c1\"># If provided, will override the default calculation, eg for ngrok</span>\n<span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Start the local API Server.&quot;&quot;&quot;</span>\n    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span>\n        <span class=\"sa\">f</span><span class=\"s2\">&quot;Starting local server. port=</span><span class=\"si\">{</span><span class=\"n\">local_port</span><span class=\"si\">}</span><span class=\"s2\">, instance_handle=</span><span class=\"si\">{</span><span class=\"n\">instance_handle</span><span class=\"si\">}</span><span class=\"s2\">, workspace=</span><span class=\"si\">{</span><span class=\"n\">workspace</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">find_api_py</span><span class=\"p\">()</span>\n    <span class=\"n\">api_module</span> <span class=\"o\">=</span> <span class=\"n\">get_api_module</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n    <span class=\"n\">invocable_class</span> <span class=\"o\">=</span> <span class=\"n\">get_class_from_module</span><span class=\"p\">(</span><span class=\"n\">api_module</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Use the provided base url (e.g. from NGROK) or default to localhost</span>\n    <span class=\"n\">_base_url</span> <span class=\"o\">=</span> <span class=\"n\">base_url</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;http://localhost&quot;</span>\n\n    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Local server base URL (for PackageService configuration) is </span><span class=\"si\">{</span><span class=\"n\">_base_url</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">invocable_class</span><span class=\"p\">:</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"s2\">&quot;Local server startup unable to find Steamship service.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;\u26a0\ufe0f Local API: Unable to find Steamship service. Please:&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;   - Check to see that you have an api.py file containing an AgentService or PackageService &quot;</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"n\">manifest</span> <span class=\"o\">=</span> <span class=\"n\">load_manifest</span><span class=\"p\">()</span>\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">manifest</span><span class=\"p\">:</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"s2\">&quot;Local server startup unable to find Steamship manifest.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;\u26a0\ufe0f Local API: Unable to find your steamship.json file&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"n\">invocable_config</span><span class=\"p\">,</span> <span class=\"n\">is_file</span> <span class=\"o\">=</span> <span class=\"n\">config_str_to_dict</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">)</span>\n    <span class=\"n\">set_unset_params</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">,</span> <span class=\"n\">invocable_config</span><span class=\"p\">,</span> <span class=\"n\">is_file</span><span class=\"p\">,</span> <span class=\"n\">manifest</span><span class=\"p\">)</span>\n\n    <span class=\"n\">server</span> <span class=\"o\">=</span> <span class=\"n\">SteamshipHTTPServer</span><span class=\"p\">(</span>\n        <span class=\"n\">invocable_class</span><span class=\"p\">,</span>\n        <span class=\"n\">base_url</span><span class=\"o\">=</span><span class=\"n\">_base_url</span><span class=\"p\">,</span>\n        <span class=\"n\">port</span><span class=\"o\">=</span><span class=\"n\">local_port</span><span class=\"p\">,</span>\n        <span class=\"n\">invocable_handle</span><span class=\"o\">=</span><span class=\"n\">manifest</span><span class=\"o\">.</span><span class=\"n\">handle</span><span class=\"p\">,</span>\n        <span class=\"n\">invocable_version_handle</span><span class=\"o\">=</span><span class=\"n\">manifest</span><span class=\"o\">.</span><span class=\"n\">version</span><span class=\"p\">,</span>\n        <span class=\"n\">invocable_instance_handle</span><span class=\"o\">=</span><span class=\"n\">instance_handle</span><span class=\"p\">,</span>\n        <span class=\"n\">config</span><span class=\"o\">=</span><span class=\"n\">invocable_config</span><span class=\"p\">,</span>\n        <span class=\"n\">workspace</span><span class=\"o\">=</span><span class=\"n\">workspace</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">start</span><span class=\"p\">()</span>\n    <span class=\"k\">except</span> <span class=\"n\">SteamshipError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;\u26a0\ufe0f Local API: </span><span class=\"si\">{</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;validation error&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">:</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;\ud83d\udca1 Suggestion: Create a configuration file called config.json containing the required &quot;</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;               configuration fields in your agent&#39;s configuration. Then run again with&quot;</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;               ship run local -c config.json&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"ne\">BaseException</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;\u26a0\ufe0f Local API: </span><span class=\"si\">{</span><span class=\"n\">e</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">&quot;Local server running.&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">on_exit</span><span class=\"p\">(</span><span class=\"n\">signum</span><span class=\"p\">,</span> <span class=\"n\">frame</span><span class=\"p\">):</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">&quot;Local server shutting down.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;Shutting down server.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">stop</span><span class=\"p\">()</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;Shut down.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">&quot;Local server shut down complete.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"n\">signal</span><span class=\"o\">.</span><span class=\"n\">signal</span><span class=\"p\">(</span><span class=\"n\">signal</span><span class=\"o\">.</span><span class=\"n\">SIGINT</span><span class=\"p\">,</span> <span class=\"n\">on_exit</span><span class=\"p\">)</span>\n\n    <span class=\"n\">local_api_url</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;http://localhost:</span><span class=\"si\">{</span><span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">port</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n\n    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Local server address: </span><span class=\"si\">{</span><span class=\"n\">local_api_url</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">local_api_url</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_run_web_interface</span><span class=\"p\">(</span><span class=\"n\">base_url</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n    <span class=\"n\">web_base</span> <span class=\"o\">=</span> <span class=\"n\">DEFAULT_WEB_BASE</span>\n    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Starting web interface. web_base=</span><span class=\"si\">{</span><span class=\"n\">web_base</span><span class=\"si\">}</span><span class=\"s2\"> and base_url=</span><span class=\"si\">{</span><span class=\"n\">base_url</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">config</span> <span class=\"o\">=</span> <span class=\"n\">Configuration</span><span class=\"p\">()</span>\n        <span class=\"n\">web_base</span> <span class=\"o\">=</span> <span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">web_base</span>\n    <span class=\"k\">except</span> <span class=\"ne\">BaseException</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;\u26a0\ufe0f Web UI:  Unable to find Steamship Configuration. Please:&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;   - Run `ship login` to make sure you have Steamship credentials in your environment.&quot;</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"c1\"># Guarantee one and only one trailing /</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">web_base</span><span class=\"o\">.</span><span class=\"n\">endswith</span><span class=\"p\">(</span><span class=\"s2\">&quot;/&quot;</span><span class=\"p\">):</span>\n        <span class=\"n\">web_base</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">web_base</span><span class=\"si\">}</span><span class=\"s2\">/&quot;</span>\n\n    <span class=\"n\">web_url</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">web_base</span><span class=\"si\">}</span><span class=\"s2\">debug?endpoint=</span><span class=\"si\">{</span><span class=\"n\">base_url</span><span class=\"si\">}</span><span class=\"s2\">/prompt&quot;</span>\n    <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Web interface url is: </span><span class=\"si\">{</span><span class=\"n\">web_url</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">web_url</span>\n\n\n<div class=\"viewcode-block\" id=\"serve_local\"><a class=\"viewcode-back\" href=\"../../../../api/steamship.cli/#steamship.cli.cli.serve_local\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">serve_local</span><span class=\"p\">(</span>\n    <span class=\"n\">port</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"mi\">8443</span><span class=\"p\">,</span>\n    <span class=\"n\">instance_handle</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">no_ngrok</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">bool</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">no_repl</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">bool</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">no_ui</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">bool</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">config</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">workspace</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Serve the invocable on localhost. Useful for debugging locally.&quot;&quot;&quot;</span>\n    <span class=\"n\">dev_logging_handler</span> <span class=\"o\">=</span> <span class=\"n\">DevelopmentLoggingHandler</span><span class=\"o\">.</span><span class=\"n\">init_and_take_root</span><span class=\"p\">()</span>\n\n    <span class=\"n\">initialize</span><span class=\"p\">()</span>\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;Running your project...</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Report the logs</span>\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;\ud83d\udcdd Log file:   </span><span class=\"si\">{</span><span class=\"n\">dev_logging_handler</span><span class=\"o\">.</span><span class=\"n\">log_filename</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Start the NGROK connection</span>\n    <span class=\"n\">ngrok_api_url</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">no_ngrok</span><span class=\"p\">:</span>\n        <span class=\"n\">ngrok_api_url</span> <span class=\"o\">=</span> <span class=\"n\">_run_ngrok</span><span class=\"p\">(</span><span class=\"n\">port</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;\ud83c\udf0e Public API: </span><span class=\"si\">{</span><span class=\"n\">ngrok_api_url</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Start the local API Server. This has to happen after NGROK because the port &amp; url need to be plummed.</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">local_api_url</span> <span class=\"o\">=</span> <span class=\"n\">_run_local_server</span><span class=\"p\">(</span>\n            <span class=\"n\">local_port</span><span class=\"o\">=</span><span class=\"n\">port</span><span class=\"p\">,</span>\n            <span class=\"n\">instance_handle</span><span class=\"o\">=</span><span class=\"n\">instance_handle</span><span class=\"p\">,</span>\n            <span class=\"n\">config</span><span class=\"o\">=</span><span class=\"n\">config</span><span class=\"p\">,</span>\n            <span class=\"n\">workspace</span><span class=\"o\">=</span><span class=\"n\">workspace</span><span class=\"p\">,</span>\n            <span class=\"n\">base_url</span><span class=\"o\">=</span><span class=\"n\">ngrok_api_url</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"ne\">BaseException</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;\u26a0\ufe0f Local API:  Unable to start local server.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">local_api_url</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;\ud83c\udf0e Local API:  </span><span class=\"si\">{</span><span class=\"n\">local_api_url</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;\u26a0\ufe0f Local API:  Unable to start local server.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Start the web UI</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">no_ui</span><span class=\"p\">:</span>\n        <span class=\"n\">web_url</span> <span class=\"o\">=</span> <span class=\"n\">_run_web_interface</span><span class=\"p\">(</span><span class=\"n\">ngrok_api_url</span> <span class=\"ow\">or</span> <span class=\"n\">local_api_url</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">web_url</span><span class=\"p\">:</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;\ud83c\udf0e Web UI:     </span><span class=\"si\">{</span><span class=\"n\">web_url</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">no_repl</span><span class=\"p\">:</span>\n        <span class=\"k\">while</span> <span class=\"kc\">True</span><span class=\"p\">:</span>\n            <span class=\"c1\"># We need to make sure the thread doesn&#39;t exit.</span>\n            <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">\ud83d\udcac Interactive REPL below. Type to interact.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">prompt_url</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">local_api_url</span><span class=\"w\"> </span><span class=\"ow\">or</span><span class=\"w\"> </span><span class=\"n\">ngrok_api_url</span><span class=\"si\">}</span><span class=\"s2\">/prompt&quot;</span>\n        <span class=\"n\">repl</span> <span class=\"o\">=</span> <span class=\"n\">HttpREPL</span><span class=\"p\">(</span><span class=\"n\">prompt_url</span><span class=\"o\">=</span><span class=\"n\">prompt_url</span><span class=\"p\">,</span> <span class=\"n\">dev_logging_handler</span><span class=\"o\">=</span><span class=\"n\">dev_logging_handler</span><span class=\"p\">)</span>\n        <span class=\"n\">repl</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">()</span></div>\n\n\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">command</span><span class=\"p\">()</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--port&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-p&quot;</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">,</span>\n    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">8443</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Port to host the server on.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--instance_handle&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-h&quot;</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Handle of the package or plugin instance being hosted.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--no-ngrok&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">is_flag</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Don&#39;t attempt to attach to ngrok.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--no-ui&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">is_flag</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Don&#39;t attempt to attach to a web UI.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--no-repl&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">is_flag</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Don&#39;t start a console REPL.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--config&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-c&quot;</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Instance configuration. May be inline JSON or a path to a file. If not specified, &quot;</span>\n    <span class=\"s2\">&quot;an empty configuration dictionary will be passed to the instance.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--workspace&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-w&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Workspace handle. The new instance will be created in this workspace. If not specified, &quot;</span>\n    <span class=\"s2\">&quot;the default workspace will be used.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">argument</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;environment&quot;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">Choice</span><span class=\"p\">([</span><span class=\"s2\">&quot;local&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;remote&quot;</span><span class=\"p\">],</span> <span class=\"n\">case_sensitive</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">pass_context</span>\n<span class=\"k\">def</span> <span class=\"nf\">run</span><span class=\"p\">(</span>\n    <span class=\"n\">ctx</span><span class=\"p\">,</span>\n    <span class=\"n\">environment</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">port</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"mi\">8080</span><span class=\"p\">,</span>\n    <span class=\"n\">instance_handle</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">no_ngrok</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">bool</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">no_ui</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">bool</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">no_repl</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">bool</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">config</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">workspace</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Serve your invocable locally or on prod&quot;&quot;&quot;</span>\n    <span class=\"k\">if</span> <span class=\"n\">environment</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;local&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">serve_local</span><span class=\"p\">(</span>\n            <span class=\"n\">port</span><span class=\"o\">=</span><span class=\"n\">port</span><span class=\"p\">,</span>\n            <span class=\"n\">instance_handle</span><span class=\"o\">=</span><span class=\"n\">instance_handle</span><span class=\"p\">,</span>\n            <span class=\"n\">no_ngrok</span><span class=\"o\">=</span><span class=\"n\">no_ngrok</span><span class=\"p\">,</span>\n            <span class=\"n\">no_repl</span><span class=\"o\">=</span><span class=\"n\">no_repl</span><span class=\"p\">,</span>\n            <span class=\"n\">no_ui</span><span class=\"o\">=</span><span class=\"n\">no_ui</span><span class=\"p\">,</span>\n            <span class=\"n\">config</span><span class=\"o\">=</span><span class=\"n\">config</span><span class=\"p\">,</span>\n            <span class=\"n\">workspace</span><span class=\"o\">=</span><span class=\"n\">workspace</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span><span class=\"s2\">&quot;Do you want to deploy a new version first?&quot;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n            <span class=\"n\">ctx</span><span class=\"o\">.</span><span class=\"n\">invoke</span><span class=\"p\">(</span><span class=\"n\">deploy</span><span class=\"p\">)</span>\n        <span class=\"n\">ctx</span><span class=\"o\">.</span><span class=\"n\">invoke</span><span class=\"p\">(</span>\n            <span class=\"n\">create_instance</span><span class=\"p\">,</span> <span class=\"n\">workspace</span><span class=\"o\">=</span><span class=\"n\">workspace</span><span class=\"p\">,</span> <span class=\"n\">instance_handle</span><span class=\"o\">=</span><span class=\"n\">instance_handle</span><span class=\"p\">,</span> <span class=\"n\">config</span><span class=\"o\">=</span><span class=\"n\">config</span>\n        <span class=\"p\">)</span>\n\n\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">command</span><span class=\"p\">()</span>\n<span class=\"k\">def</span> <span class=\"nf\">deploy</span><span class=\"p\">():</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Deploy the package or plugin in this directory&quot;&quot;&quot;</span>\n    <span class=\"n\">initialize</span><span class=\"p\">()</span>\n    <span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"n\">Steamship</span><span class=\"p\">()</span>\n    <span class=\"k\">except</span> <span class=\"n\">SteamshipError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"n\">fg</span><span class=\"o\">=</span><span class=\"s2\">&quot;red&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">get_current_context</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">abort</span><span class=\"p\">()</span>\n\n    <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">User</span><span class=\"o\">.</span><span class=\"n\">current</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">exists</span><span class=\"p\">(</span><span class=\"s2\">&quot;steamship.json&quot;</span><span class=\"p\">):</span>\n        <span class=\"n\">manifest</span> <span class=\"o\">=</span> <span class=\"n\">Manifest</span><span class=\"o\">.</span><span class=\"n\">load_manifest</span><span class=\"p\">()</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">manifest</span> <span class=\"o\">=</span> <span class=\"n\">manifest_init_wizard</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">)</span>\n        <span class=\"n\">manifest</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">exists</span><span class=\"p\">(</span><span class=\"s2\">&quot;requirements.txt&quot;</span><span class=\"p\">):</span>\n        <span class=\"n\">requirements_init_wizard</span><span class=\"p\">()</span>\n\n    <span class=\"n\">deployable_type</span> <span class=\"o\">=</span> <span class=\"n\">manifest</span><span class=\"o\">.</span><span class=\"n\">type</span>\n\n    <span class=\"n\">update_config_template</span><span class=\"p\">(</span><span class=\"n\">manifest</span><span class=\"p\">)</span>\n\n    <span class=\"n\">deployer</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">if</span> <span class=\"n\">deployable_type</span> <span class=\"o\">==</span> <span class=\"n\">DeployableType</span><span class=\"o\">.</span><span class=\"n\">PACKAGE</span><span class=\"p\">:</span>\n        <span class=\"n\">deployer</span> <span class=\"o\">=</span> <span class=\"n\">PackageDeployer</span><span class=\"p\">()</span>\n    <span class=\"k\">elif</span> <span class=\"n\">deployable_type</span> <span class=\"o\">==</span> <span class=\"n\">DeployableType</span><span class=\"o\">.</span><span class=\"n\">PLUGIN</span><span class=\"p\">:</span>\n        <span class=\"n\">deployer</span> <span class=\"o\">=</span> <span class=\"n\">PluginDeployer</span><span class=\"p\">()</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;Deployable must be of type package or plugin.&quot;</span><span class=\"p\">,</span> <span class=\"n\">fg</span><span class=\"o\">=</span><span class=\"s2\">&quot;red&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">get_current_context</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">abort</span><span class=\"p\">()</span>\n\n    <span class=\"n\">deployable</span> <span class=\"o\">=</span> <span class=\"n\">deployer</span><span class=\"o\">.</span><span class=\"n\">create_or_fetch_deployable</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">,</span> <span class=\"n\">manifest</span><span class=\"p\">)</span>\n\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"s2\">&quot;Bundling content... &quot;</span><span class=\"p\">,</span> <span class=\"n\">nl</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n    <span class=\"n\">bundle_deployable</span><span class=\"p\">(</span><span class=\"n\">manifest</span><span class=\"p\">)</span>\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"s2\">&quot;Done. \ud83d\udce6&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">deployer</span><span class=\"o\">.</span><span class=\"n\">create_version</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">,</span> <span class=\"n\">manifest</span><span class=\"p\">,</span> <span class=\"n\">deployable</span><span class=\"o\">.</span><span class=\"n\">id</span><span class=\"p\">)</span>\n\n    <span class=\"n\">thing_url</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">web_base</span><span class=\"si\">}{</span><span class=\"n\">deployable_type</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s2\">s/</span><span class=\"si\">{</span><span class=\"n\">manifest</span><span class=\"o\">.</span><span class=\"n\">handle</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span>\n        <span class=\"sa\">f</span><span class=\"s2\">&quot;Deployment was successful. View and share your new </span><span class=\"si\">{</span><span class=\"n\">deployable_type</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s2\"> here:</span><span class=\"se\">\\n\\n</span><span class=\"si\">{</span><span class=\"n\">thing_url</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"c1\"># Common error conditions:</span>\n    <span class=\"c1\"># - Package/plugin handle already taken. [handled; asks user for new]</span>\n    <span class=\"c1\"># - Version handle already deployed. [handled; asks user for new]</span>\n    <span class=\"c1\"># - Bad parameter configuration. [mitigated by deriving template from Config object]</span>\n    <span class=\"c1\"># - Package content fails health check (ex. bad import) [Error caught while checking config object]</span>\n\n\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">command</span><span class=\"p\">()</span>\n<span class=\"k\">def</span> <span class=\"nf\">info</span><span class=\"p\">():</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Displays information about the current Steamship user.</span>\n\n<span class=\"sd\">    This is useful to help users (in a support or hackathon context) test whether they have configured their</span>\n<span class=\"sd\">    Steamship environment correctly.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">initialize</span><span class=\"p\">()</span>\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">Steamship Client Info</span><span class=\"se\">\\n</span><span class=\"s2\">=====================</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">Configuration</span><span class=\"o\">.</span><span class=\"n\">default_config_file_has_api_key</span><span class=\"p\">()</span> <span class=\"ow\">or</span> <span class=\"n\">getenv</span><span class=\"p\">(</span><span class=\"s2\">&quot;STEAMSHIP_API_KEY&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"c1\"># User is logged in!</span>\n        <span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"n\">Steamship</span><span class=\"p\">()</span>\n        <span class=\"k\">except</span> <span class=\"ne\">BaseException</span><span class=\"p\">:</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;Incorrect API key or network error.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">,</span> <span class=\"n\">fg</span><span class=\"o\">=</span><span class=\"s2\">&quot;red&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Your Steamship API Key is set, but we were unable to use it to fetch your account information.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;- If you are on your own computer, run `ship login` to login.&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;- If you are in Replit, add the STEAMSHIP_API_KEY secret, then close and re-open this shell.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span>\n\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">User</span><span class=\"o\">.</span><span class=\"n\">current</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;User handle: </span><span class=\"si\">{</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">handle</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;User ID:     </span><span class=\"si\">{</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">id</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Profile:     </span><span class=\"si\">{</span><span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">profile</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">Ready to ship! \ud83d\udea2\ud83d\udea2\ud83d\udea2</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">except</span> <span class=\"ne\">BaseException</span><span class=\"p\">:</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;Incorrect API key or network error.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">,</span> <span class=\"n\">fg</span><span class=\"o\">=</span><span class=\"s2\">&quot;red&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Your Steamship API Key is set, but we were unable to use it to fetch your account information.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;- If you are on your own computer, run `ship login` to login.&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;- If you are in Replit, add the STEAMSHIP_API_KEY secret, then close and re-open this shell.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n            <span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;You are not logged in.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span><span class=\"s2\">&quot;- If you are on your own computer, run `ship login` to login.&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">secho</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;- If you are in Replit, add the STEAMSHIP_API_KEY secret, then close and re-open this shell.</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n        <span class=\"p\">)</span>\n\n\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">command</span><span class=\"p\">()</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--workspace&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-w&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Workspace handle used for scoping logs request. All requests MUST be scoped by workspace.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--offset&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-o&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Starting index from sorted logs to return a chunk. Used for paging. Defaults to 0.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--number&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-n&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">50</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Number of logs to return in a single batch. Defaults to 50.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--package&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-p&quot;</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Package handle. Used to filter logs returend to a specific package (across all instances).&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--instance&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-i&quot;</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Instance handle. Used to filter logs returned to a specific instance of a package.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--version&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-v&quot;</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Version handle. Used to filter logs returned to a specific version of a package.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--path&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;request_path&quot;</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Path invoked by a client operation. Used to filter logs returned to a specific invocation path.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"nd\">@click</span><span class=\"o\">.</span><span class=\"n\">option</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;--with-fields&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;-f&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;field_values&quot;</span><span class=\"p\">,</span>\n    <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;Dictionary of log field values (format: key1=value1,key2=value2,...). Used to filter logs returned.&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">logs</span><span class=\"p\">(</span>\n    <span class=\"n\">workspace</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span>\n    <span class=\"n\">offset</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n    <span class=\"n\">number</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n    <span class=\"n\">package</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">instance</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">version</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">request_path</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">field_values</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Retrieve logs within a workspace.&quot;&quot;&quot;</span>\n\n    <span class=\"n\">initialize</span><span class=\"p\">(</span><span class=\"n\">suppress_message</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n    <span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"n\">Steamship</span><span class=\"p\">(</span><span class=\"n\">workspace</span><span class=\"o\">=</span><span class=\"n\">workspace</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"n\">SteamshipError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">UsageError</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">)</span>\n\n    <span class=\"n\">value_dict</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"k\">if</span> <span class=\"n\">field_values</span><span class=\"p\">:</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"n\">field_values</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s2\">&quot;,&quot;</span><span class=\"p\">):</span>\n                <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s2\">&quot;=&quot;</span><span class=\"p\">)</span>\n                <span class=\"n\">value_dict</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n        <span class=\"k\">except</span> <span class=\"ne\">ValueError</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">UsageError</span><span class=\"p\">(</span>\n                <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"s2\">&quot;Invalid dictionary format for fields. Please provide a dictionary in the &quot;</span>\n                <span class=\"s2\">&quot;format: key1=value1,key2=value2,...&quot;</span>\n            <span class=\"p\">)</span>\n\n    <span class=\"n\">click</span><span class=\"o\">.</span><span class=\"n\">echo</span><span class=\"p\">(</span>\n        <span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span>\n            <span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">logs</span><span class=\"p\">(</span><span class=\"n\">offset</span><span class=\"p\">,</span> <span class=\"n\">number</span><span class=\"p\">,</span> <span class=\"n\">package</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"n\">version</span><span class=\"p\">,</span> <span class=\"n\">request_path</span><span class=\"p\">,</span> <span class=\"n\">value_dict</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"n\">cli</span><span class=\"o\">.</span><span class=\"n\">add_command</span><span class=\"p\">(</span><span class=\"n\">login</span><span class=\"p\">)</span>\n<span class=\"n\">cli</span><span class=\"o\">.</span><span class=\"n\">add_command</span><span class=\"p\">(</span><span class=\"n\">deploy</span><span class=\"p\">)</span>\n<span class=\"n\">cli</span><span class=\"o\">.</span><span class=\"n\">add_command</span><span class=\"p\">(</span><span class=\"n\">info</span><span class=\"p\">)</span>\n<span class=\"n\">cli</span><span class=\"o\">.</span><span class=\"n\">add_command</span><span class=\"p\">(</span><span class=\"n\">deploy</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;it&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">cli</span><span class=\"o\">.</span><span class=\"n\">add_command</span><span class=\"p\">(</span><span class=\"n\">ships</span><span class=\"p\">)</span>\n<span class=\"n\">cli</span><span class=\"o\">.</span><span class=\"n\">add_command</span><span class=\"p\">(</span><span class=\"n\">logs</span><span class=\"p\">)</span>\n<span class=\"n\">cli</span><span class=\"o\">.</span><span class=\"n\">add_command</span><span class=\"p\">(</span><span class=\"n\">run</span><span class=\"p\">)</span>\n<span class=\"n\">cli</span><span class=\"o\">.</span><span class=\"n\">add_command</span><span class=\"p\">(</span><span class=\"n\">create_instance</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;use&quot;</span><span class=\"p\">)</span>\n</pre></div>", "current_page_name": "_modules/steamship/cli/cli", "sidebars": ["sidebar/brand.html", "sidebar/search.html", "sidebar/scroll-start.html", "sidebar/navigation.html", "sidebar/ethical-ads.html", "sidebar/scroll-end.html", "sidebar/variant-selector.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.12", "furo_version": "2023.03.27", "furo_navigation_tree": "", "furo_hide_toc": true, "furo_pygments": {"light": {"background": "#f8f8f8", "foreground": "black"}, "dark": {"background": "#272822", "foreground": "#f8f8f2"}}}